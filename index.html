<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Inecta Discovery Assistant</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@700&family=Verdana&display=swap" rel="stylesheet">
  <style>
    :root {
      /* Official Inecta Brand Colors */
      --inecta-green: #124030;
      --inecta-teal: #00CCCC;
      --inecta-yellow: #FFD44D;
      --inecta-tan: #DECF9E;
      --dark-grey: #575763;
      --light-grey: #999999;
      
      /* UI Theme Colors */
      --background-light: #F8F8F8;
      --border-color: #EAEAEA;
      --body-text-color: #293036;
      --bot-bubble-bg: #FFFFFF;
      --user-bubble-bg: var(--inecta-green);

      /* Typography from Brand Guide */
      --font-heading: 'Open Sans', sans-serif;
      --font-body: 'Verdana', sans-serif;
    }
    body {
      font-family: var(--font-body);
      background: var(--background-light);
      color: var(--body-text-color);
      padding: 20px;
      margin: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      box-sizing: border-box;
    }
    .container {
      width: 100%;
      max-width: 800px;
      display: flex;
      flex-direction: column;
      height: 100%;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.08);
      border-radius: 16px;
      overflow: hidden;
      background: #FFFFFF;
    }
    .header {
      padding: 15px 20px;
      background: #FFFFFF;
      border-bottom: 1px solid var(--border-color);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .header img {
      height: 28px;
      width: auto;
    }
    #newChatBtn {
      padding: 6px 12px;
      font-size: 12px;
      font-family: var(--font-heading);
      font-weight: 700;
      background-color: var(--light-grey);
      color: white;
      border: none;
      border-radius: 15px;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }
    #newChatBtn:hover {
      background-color: var(--dark-grey);
    }
    .topic-tracker { 
      display: flex; 
      flex-wrap: wrap; 
      gap: 8px; 
      padding: 15px 20px;
      justify-content: center;
      border-bottom: 1px solid var(--border-color);
    }
    .topic-item { 
      padding: 6px 12px; 
      border-radius: 15px; 
      font-size: 12px; 
      font-family: var(--font-heading);
      font-weight: 700;
      transition: all 0.3s ease; 
      border: 1px solid transparent; 
    }
    .status-not-started { background-color: #E0E0E0; color: #616161; }
    .status-in-progress { background-color: var(--inecta-tan); color: var(--inecta-green); animation: pulse-tan 2s infinite; }
    .status-completed { background-color: var(--inecta-green); color: #FFFFFF; }
    @keyframes pulse-tan {
      0% { box-shadow: 0 0 0 0 rgba(222, 207, 158, 0.7); }
      70% { box-shadow: 0 0 0 8px rgba(222, 207, 158, 0); }
      100% { box-shadow: 0 0 0 0 rgba(222, 207, 158, 0); }
    }
    .chat {
      padding: 30px;
      flex-grow: 1;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 15px;
      background-color: var(--background-light);
    }
    .chat::-webkit-scrollbar { width: 8px; }
    .chat::-webkit-scrollbar-track { background: var(--background-light); border-radius: 4px; }
    .chat::-webkit-scrollbar-thumb { background-color: #d4d4d4; border-radius: 4px; }
    .chat::-webkit-scrollbar-thumb:hover { background-color: var(--dark-grey); }
    .msg {
      padding: 12px 18px;
      border-radius: 20px;
      line-height: 1.6;
      max-width: 80%;
      white-space: pre-wrap;
      word-wrap: break-word;
    }
    .user {
      background-color: var(--user-bubble-bg);
      color: #FFFFFF;
      border-bottom-right-radius: 5px;
      align-self: flex-end;
    }
    .bot {
      background-color: var(--bot-bubble-bg);
      color: var(--body-text-color);
      border: 1px solid var(--border-color);
      border-bottom-left-radius: 5px;
      align-self: flex-start;
    }
    .typing-indicator {
      display: flex;
      align-items: center;
      padding: 12px 18px;
    }
    .typing-indicator span {
      height: 8px; width: 8px; background-color: #BDBDBD;
      border-radius: 50%; display: inline-block; margin: 0 2px;
      animation: bounce 1.4s infinite ease-in-out both;
    }
    .typing-indicator span:nth-of-type(2) { animation-delay: -0.2s; }
    .typing-indicator span:nth-of-type(3) { animation-delay: -0.4s; }
    @keyframes bounce {
      0%, 80%, 100% { transform: scale(0); }
      40% { transform: scale(1.0); }
    }
    .input-area {
      display: flex;
      gap: 10px;
      padding: 20px;
      border-top: 1px solid var(--border-color);
      background: #FFFFFF;
      align-items: center;
    }
    #messageInput {
      flex-grow: 1;
      padding: 12px 18px;
      border-radius: 22px;
      border: 1px solid var(--border-color);
      background: var(--background-light);
      color: var(--body-text-color);
      font-size: 16px;
      font-family: var(--font-body);
    }
    #messageInput:focus {
        outline: none;
        border-color: var(--inecta-teal);
        box-shadow: 0 0 0 2px rgba(0, 204, 204, 0.2);
    }
    #sendButton, #uploadButton {
      background-color: var(--inecta-teal);
      color: #000000;
      border: none;
      cursor: pointer;
      border-radius: 50%;
      width: 44px;
      height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
      flex-shrink: 0;
    }
    #reportButton, #scheduleButton {
      padding: 10px 20px;
      border-radius: 20px;
      border: none;
      cursor: pointer;
      font-family: var(--font-heading);
      font-weight: 700;
      text-transform: uppercase;
      transition: all 0.2s ease;
      font-size: 16px;
      white-space: nowrap;
      background-color: var(--inecta-green);
      color: #FFFFFF;
      display: none; /* Hidden by default */
      flex-grow: 1;
    }
    #sendButton:disabled, #uploadButton:disabled {
      background-color: #BDBDBD;
      cursor: not-allowed;
    }
    #sendButton:hover:not(:disabled), #uploadButton:hover:not(:disabled), #reportButton:hover:not(:disabled), #scheduleButton:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
  </style>
</head>
<body>

  <div class="container">
    <div class="header">
      <img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgoKPHN2ZwogICB2ZXJzaW9uPSIxLjEiCiAgIGlkPSJzdmcyIgogICB3aWR0aD0iNjM1Ljc5OTk5IgogICBoZWlnaHQ9IjE0MC4yOTMzMyIKICAgdmlld0JveD0iMCAwIDYzNS43OTk5OSAxNDAuMjkzMzMiCiAgIHNvZGlwb2RpOmRvY25hbWU9IklORUNUQV9MT0dPX1BSSU1BUlkuZXBzIgogICB4bWxuczppbmtzY2FwZT0iaHR0cDovL3d3dy5pbmtzY2FwZS5vcmcvbmFtZXNwYWNlcy9pbmtzY2FwZSIKICAgeG1sbnM6c29kaXBvZGk9Imh0dHA6Ly9zb2RpcG9kaS5zb3VyY2Vmb3JnZS5uZXQvRFREL3NvZGlwb2RpLTAuZHRkIgogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zOnN2Zz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogIDxkZWZzCiAgICAgaWQ9ImRlZnM2IiAvPgogIDxzb2RpcG9kaTpuYW1lZHZpZXcKICAgICBpZD0ibmFtZWR2aWV3NCIKICAgICBwYWdlY29sb3I9IiNmZmZmZmYiCiAgICAgYm9yZGVyY29sb3I9IiMwMDAwMDAiCiAgICAgYm9yZGVyb3BhY2l0eT0iMC4yNSIKICAgICBpbmtzY2FwZTpzaG93cGFnZXNoYWRvdz0iMiIKICAgICBpbmtzY2FwZTpwYWdlb3BhY2l0eT0iMC4wIgogICAgIGlua3NjYXBlOnBhZ2VjaGVja2VyYm9hcmQ9IjAiCiAgICAgaW5rc2NhcGU6ZGVza2NvbG9yPSIjZDFkMWQxIiAvPgogIDxnCiAgICAgaWQ9Imc4IgogICAgIGlua3NjYXBlOmdyb3VwbW9kZT0ibGF5ZXIiCiAgICAgaW5rc2NhcGU6bGFiZWw9Imlua19leHRfWFhYWFhYIgogICAgIHRyYW5zZm9ybT0ibWF0cml4KDEuMzMzMzMzMywwLDAsLTEuMzMzMzMzMywwLDE0MC4yOTMzMykiPgogICAgPGcKICAgICAgIGlkPSJnMTAiCiAgICAgICB0cmFuc2Zvcm09InNjYWxlKDAuMSkiPgogICAgICA8cGF0aAogICAgICAgICBkPSJNIDk4OS41OTgsNzcyLjY2NCBIIDExOTIuNTUgViAyMi44Nzg5IEggOTg5LjU5OCBWIDc3My42NjQiCiAgICAgICAgIHN0eWxlPSJmaWxsOiMxZjQ5M2E7ZmlsbC1vcGFjaXR5OjE7ZmlsbC1ydWxlOm5vbnplcm87c3Ryb2tlOm5vbmUiCiAgICAgICAgIGlkPSJwYXRoMTIiIC8+CiAgICAgIDxwYXRoCiAgICAgICAgIGQ9Ik0gMTQ5MC4xMiwyMi44NzExIEggMTI4Ny4xNyBWIDc3My42NTYgaCAxOTYuODQgdiAtOTMuMDkzIGMgNDUuNzcsNzcuODUxIDEzNS44MiwxMTIuOTI5IDIxNi43LDExMi45MjkgMTg2LjE2LDAgMjcxLjYxLC0xMzIuNzYyIDI3MS42MSwtMjk3LjU2MiBWIDIyLjg3MTEgSCAxNzY5LjM4IFYgNDYwLjg1MiBjIDAsODMuOTE4IC00MS4yMSwxNDkuNTQzIC0xMzguODcsMTQ5LjU0MyAtODguNSwwIC0xNDAuMzksLTY4LjY3MiAtMTQwLjM5LC0xNTUuNjc2IFYgMjIuODcxMSIKICAgICAgICAgc3R5bGU9ImZpbGw6IzFmNDkzYTtmaWxsLW9wYWNpdHk6MTtmaWxsLXJ1bGU6bm9uemVybztzdHJva2U6bm9uZSIKICAgICAgICAgaWQ9InBhdGgxNCIgLz4KICAgICAgPHBhdGgKICAgICAgICAgZD0iTSAyNzU5Ljc3LDIzOC4wMiBDIDI3MjEuNjMsMTA4LjMzMiAyNjAyLjU5LDAgMjQxNy45NiwwIGMgLTIwNi4wMiwwIC0zODcuNTksMTQ4IC0zODcuNTksNDAxLjMyIDAsMjM5LjU5IDE3NywzOTUuMjM1IDM2OS4yOCwzOTUuMjM1IDIyMS45NCwwIDM3MC44LC0xNDguMDIgMzcwLjgsLTM4OS4xMjkgMCwtMjguOTg1IC0zLjA0LC01OS41MjQgLTMuMDQsLTYyLjU3MSBoIC01MzcuMTYgYyA0LjU5LC05OS4xNzkgODguNTEsLTE3MC44ODYgMTg5LjIzLC0xNzAuODg2IDk0LjYyLDAgMTQ2LjUsNDcuMjg1IDE3MC45LDExNC40NDAgeiBtIC0xODkuMjIsMjQ1LjcwMyBjIC0zLjA1LDc0Ljc4OSAtNTEuODcsMTQ4LjAyMyAtMTY3Ljg2LDE0OC4wMjMgLTEwNS4zMSwwIC0xNjMuMjgsLTc5LjM0IC0xNjcuODUsLTE0OC4wMjMgaCAzMzUuNzEiCiAgICAgICAgIHN0eWxlPSJmaWxsOiMxZjQ5M2E7ZmlsbC1vcGFjaXR5OjE7ZmlsbC1ydWxlOm5vbnplcm87c3Ryb2tlOm5vbmUiCiAgICAgICAgIGlkPSJwYXRoMTYiIC8+CiAgICAgIDxwYXRoCiAgICAgICAgIGQ9Im0gMzA0Ni42OSwzOTguMjczIGMgMCwtMTM1LjgxOCA4OC41LC0yMTIuMTI4IDE5Mi4yNywtMjEyLjEyOCAxMDMuNzcsMCAxNTUuNjYsNjguNjcxIDE3Mi40NCwxMjYuNjYgbCAxNzguNTQsLTU5LjUxMiBDIDM1NTYuMzksMTI4LjE3NiAzNDM4Ljg3LDAgMzIzOC45NiwwIDMwMTcuNywwIDI4NDMuNzQsMTY3Ljg0NCAyODQzLjc0LDM5OC4yNzMgYyAwLDIzMS45MzggMTcwLjksMzk4LjI2NiAzODkuMTEsMzk4LjI2NiAyMDQuNDgsMCAzMjAuNDcsLTEyNi42NDggMzUyLjUyLC0yNTMuMjg5IGwgLTE4MS41OSwtNjEuMDM5IGMgLTE4LjMzLDYyLjU1OSAtNjUuNjQsMTI2LjY0NCAtMTY2LjM2LDEyNi42NDQgLTEwMy43NSwwIC0xOTAuNzMsLTc0Ljc2OSAtMTkwLjczLC0yMTAuNTgyIgogICAgICAgICBzdHlsZT0iZmlsbDojMWY0OTNhO2ZpbGwtb3BhY2l0eToxO2ZpbGwtcnVsZTpub256ZXJvO3N0cm9rZTpub25lIgogICAgICAgICBpZD0icGF0aDE4IiAvPgogICAgICA8cGF0aAogICAgICAgICBkPSJtIDM2NzIuODIsMTA1Mi4xNiBoIDIwMS44MyBWIDc3My42NDUgaCAxNTEuMDYgViA1OTMuNjE3IEggMzg3NC4yNSBWIDI3OS4yNDIgYyAwLC02NS42MzcgMzAuNTIsLTg2Ljk2NSA4OC41LC04Ni45NjUgMjQuNDIsMCA1MS44OSwzLjAyOCA2Mi41Niw2LjA4NiBWIDMwLjUxMTcgYyAtMTguMjksLTcuNjQwNiAtNTQuOTMsLTE4LjMzMiAtMTE0LjQ0LC0xOC4zMzIgLTE0Ni40OSwwIC0yMzguMDUsODYuOTg0NCAtMjM4LjA1LDIzMS45NjUzIHYgODA4LjAxNSIKICAgICAgICAgc3R5bGU9ImZpbGw6IzFmNDkzYTtmaWxsLW9wYWNpdHk6MTtmaWxsLXJ1bGU6bm9uemVybztzdHJva2U6bm9uZSIKICAgICAgICAgaWQ9InBhdGgyMCIgLz4KICAgICAgPHBhdGgKICAgICAgICAgZD0ibSA0MzE5LjgyLDQ1NC43MyAxODQuNjUsMjcuNDY5IGMgNDIuNzMsNi4xMDYgNTYuNDcsMjcuNDgxIDU2LjQ3LDUzLjQwMyAwLDUzLjQwNiAtNDEuMjEsOTcuNjc1IC0xMjYuNjcsOTcuNjc1IC04OC40OCwwIC0xMzcuMzIsLTU2LjQ3MiAtMTQzLjQxLC0xMjIuMDkzIGwgLTE4MC4xLDM4LjE1NiBjIDEyLjIzLDExNy41MTkgMTIwLjU5LDI0Ny4yMDcgMzIxLjk5LDI0Ny4yMDcgMjM4LjA3LDAgMzI2LjU3LC0xMzQuMjg1IDMyNi41NywtMjg1LjM2MyBWIDE0MS44OTggYyAwLC0zOS42ODcgNC41NywtOTMuMDg5NCA5LjE2LC0xMTkuMDE5MSBoIC0xODYuMTkgYyAtNC41NywxOS44NTE2IC03LjYxLDYxLjA1MDggLTcuNjEsOTAuMDM1MSBDIDQ1MzYuNTEsNTMuMzkwNiA0NDY0LjgsMS41MTE3MiA0MzUzLjQsMS41MTE3MiBjIC0xNjAuMjMsMCAtMjU3Ljg4LDEwOC4zMzYyOCAtMjU3Ljg4LDIyNS44NDMyOCAwLDEzNC4yOSA5OS4xOSwyMDkuMDYzIDIyNC4zLDIyNy4zNzUgbSAyNDEuMTIsLTEyOC4xNzUgdiAzMy41NTQgbCAtMTY5LjM4LC0yNS45MTggYyAtNTEuODgsLTcuNjM2IC05My4wOCwtMzYuNjQgLTkzLjA4LC05NC42MTcgMCwtNDQuMjY5IDMyLjA1LC04Ni45ODQgOTcuNjcsLTg2Ljk4NCA4NS40NCwwIDE2NC43OSw0MS4xOTEgMTY0Ljc5LDE3My45NjUiCiAgICAgICAgIHN0eWxlPSJmaWxsOiMxZjQ5M2E7ZmlsbC1vcGFjaXR5OjE7ZmlsbC1ydWxlOm5vbnplcm87c3Ryb2tlOm5vbmUiCiAgICAgICAgIGlkPSJwYXRoMjIiIC8+CiAgICAgIDxwYXRoCiAgICAgICAgIGQ9Im0gMTE5MS44Miw5NTEuNDAyIGMgMCw1NS42NTggLTQ1LjExLDEwMC43NjggLTEwMC43NSwxMDAuNzY4IC01NS42NSwwIC0xMDAuNzc3LC00NS4xMSAtMTAwLjc3NywtMTAwLjc2OCAwLC01NS42NDggNDUuMTI3LC0xMDAuNzU0IDEwMC43NzcsLTEwMC43NTQgNTUuNjQsMCAxMDAuNzUsNDUuMTA2IDEwMC43NSwxMDAuNzU0IgogICAgICAgICBzdHlsZT0iZmlsbDojMWY0OTNhO2ZpbGwtb3BhY2l0eToxO2ZpbGwtcnVsZTpub256ZXJvO3N0cm9rZTpub25lIgogICAgICAgICBpZD0icGF0aDI0IiAvPgogICAgICA8cGF0aAogICAgICAgICBkPSJtIDIxMy4zOTgsMzg1LjM1NSBjIC02LjE4NywwLjY4NCAtMTIuNDY4LDEuMDYzIC0xOC44NDMsMS4wNjMgSCAwIFYgMTkxLjg2NyBDIDAsOTguNTM5MSA3NS42NTYzLDIyLjg3ODkgMTY4Ljk4OCwyMi44Nzg5IEggMzYzLjUzNSBMIDIyNS45NjksMTYwLjQ0OSBjIC02MS40ODksNjEuNDk2IC02NS42NTMsMTU4LjU1OSAtMTIuNTcxLDIyNC45MDYiCiAgICAgICAgIHN0eWxlPSJmaWxsOiNhN2UxZGU7ZmlsbC1vcGFjaXR5OjE7ZmlsbC1ydWxlOm5vbnplcm87c3Ryb2tlOm5vbmUiCiAgICAgICAgIGlkPSJwYXRoMjYiIC8+CiAgICAgIDxwYXRoCiAgICAgICAgIGQ9Im0gNTMyLjUyMywzODYuNDE4IGMgLTYuMzc4LDAgLTEyLjY1NiwtMC4zNzkgLTE4Ljg0MywtMS4wNjMgNTMuMDgyLC02Ni4zNDcgNDguOTE4LC0xNjMuNDEgLTEyLjU3NSwtMjI0LjkwNiBMIDM2My41MzksMjIuODc4OSBIIDU1OC4wOSBjIDkzLjMyNCwwIDE2OC45ODgsNzUuNjYwMiAxNjguOTg4LDE2OC45ODgxIFYgMzg2LjQxOCBIIDUzMi41MjMiCiAgICAgICAgIHN0eWxlPSJmaWxsOiM2ZTk0ODY7ZmlsbC1vcGFjaXR5OjE7ZmlsbC1ydWxlOm5vbnplcm87c3Ryb2tlOm5vbmUiCiAgICAgICAgIGlkPSJwYXRoMjgiIC8+CiAgICAgIDxwYXRoCiAgICAgICAgIGQ9Im0gMzYzLjUzOSwyMTcuNDM0IGMgMCw4Ni45NTMgNjUuNjg0LDE1OC41NDYgMTUwLjE0MSwxNjcuOTEgLTMuOTAzLDQuODc1IC04LjA2Nyw5LjU4MiAtMTIuNTc1LDE0LjA5NCBMIDM2My41MzksNTM3LjAwNCBMIDIyNS45NjksMzk5LjQzOCBjIC00LjUxMiwtNC41MTIgLTguNjc2LC05LjIxOSAtMTIuNTY3LC0xNC4wOTQgODQuNDUsLTkuMzY0IDE1MC4xMzcsLTgwLjk1NyAxNTAuMTM3LC0xNjcuOTEiCiAgICAgICAgIHN0eWxlPSJmaWxsOiNhN2UxZGU7ZmlsbC1vcGFjaXR5OjE7ZmlsbC1ydWxlOm5vbnplcm87c3Ryb2tlOm5vbmUiCiAgICAgICAgIGlkPSJwYXRoMzAiIC8+CiAgICAgIDxwYXRoCiAgICAgICAgIGQ9Ik0gMjEzLjM5OCwzODUuMzU1IEwgMTYwLjMxNiwzMTkuMDA4IDE2NC40OCwyMjEuOTQ1IDIyNS45NjksMTYwLjQ0OSBMIDM2My41MzUsMjIuODc4OSBWIDIxNy40MzQgYyAwLDg2Ljk1MyAtNjUuNjgsMTU4LjUzNSAtMTUwLjEzNywxNjcuOTIxIgogICAgICAgICBzdHlsZT0iZmlsbDojNTBjNGJmO2ZpbGwtb3BhY2l0eToxO2ZpbGwtcnVsZTpub256ZXJvO3N0cm9rZTpub25lIgogICAgICAgICBpZD0icGF0aDMyIiAvPgogICAgICA8cGF0aAogICAgICAgICBkPSJNIDUxMy42NzYsMzg1LjM1NSBDIDQyOS4yMjMsMzc1Ljk2OSAzNjMuNTM1LDMwNC4zODcgMzYzLjUzNSwyMTcuNDM0IFYgMjIuODc4OSBsIDEzNy41NywxMzcuNTcwMSBjIDYxLjQ4NSw2MS40OTYgNjUuNjU3LDE1OC41NTkgMTIuNTcxLDIyNC45MDYiCiAgICAgICAgIHN0eWxlPSJmaWxsOiMxZjQ5M2E7ZmlsbC1vcGFjaXR5OjE7ZmlsbC1ydWxlOm5vbnplcm87c3Ryb2tlOm5vbmUiCiAgICAgICAgIGlkPSJwYXRoMzQiIC8+CiAgICAgIDxwYXRoCiAgICAgICAgIGQ9Im0gMjEzLjM5OCw5MDAuNTA0IGMgLTYuMTg3LDAuNjkxIC0xMi40NjgsMS4wNyAtMTguODQzLDEuMDcgTCAwLDkwMS41NzQgViA3MDcuMDI3IEMgMCw2MTMuNjk5IDc1LjY1NjMsNTM4LjAzNSAxNjguOTg4LDUzOC4wMzUgSCAzNjMuNTM1IEwgMjI1Ljk2OSw2NzUuNjA5IGMgLTYxLjQ4OSw2MS40ODkgLTY1LjY1MywxNTguNTQ3IC0xMi41NzEsMjI0Ljg5NSIKICAgICAgICAgc3R5bGU9ImZpbGw6I2E3ZTFkZTtmaWxsLW9wYWNpdHk6MTtmaWxsLXJ1bGU6bm9uemVybztzdHJva2U6bm9uZSIKICAgICAgICAgaWQ9InBhdGgzNiIgLz4KICAgICAgPHBhdGgKICAgICAgICAgZD0ibSA1MzIuNTIzLDkwMS41NzQgYyAtNi4zNzgsMCAtMTIuNjU2LC0wLjM3OSAtMTguODQzLC0xLjA3IDUzLjA4MiwtNjYuMzQ4IDQ4LjkxOCwtMTYzLjQwNiAtMTIuNTc1LC0yMjQuODk1IEwgMzYzLjUzOSw1MzguMDM1IEggNTU4LjA5IGMgOTMuMzI0LDAgMTY4Ljk4OCw3NS42NjQgMTY4Ljk4OCwxNjguOTkyIFYgOTAxLjU3NCBIIDUzMi41MjMiCiAgICAgICAgIHN0eWxlPSJmaWxsOiM2ZTk0ODY7ZmlsbC1vcGFjaXR5OjE7ZmlsbC1ydWxlOm5vbnplcm87c3Ryb2tlOm5vbmUiCiAgICAgICAgIGlkPSJwYXRoMzgiIC8+CiAgICAgIDxwYXRoCiAgICAgICAgIGQ9Im0gMzYzLjUzOSw3MzIuNTkgYyAwLDg2Ljk1MyA2NS42ODQsMTU4LjUzNSAxNTAuMTQxLDE2Ny45MSAtMy45MDMsNC44NjcgLTguMDY3LDkuNTgyIC0xMi41NzUsMTQuMDgyIEwgMzYzLjUzOSwxMDUyLjE2IEwgMjI1Ljk2OSw5MTQuNTgyIGMgLTQuNTEyLC00LjUgLTguNjc2LC05LjIxNSAtMTIuNTY3LC0xNC4wODIgODQuNDUsLTkuMzc1IDE1MC4xMzcsLTgwLjk1NyAxNTAuMTM3LC0xNjcuOTEiCiAgICAgICAgIHN0eWxlPSJmaWxsOiNhN2UxZGU7ZmlsbC1vcGFjaXR5OjE7ZmlsbC1ydWxlOm5vbnplcm87c3Ryb2tlOm5vbmUiCiAgICAgICAgIGlkPSJwYXRoNDAiIC8+CiAgICAgIDxwYXRoCiAgICAgICAgIGQ9Ik0gMjEzLjM5OCw5MDAuNTA0IEMgMTYwLjMxNiw4MzQuMTU2IDE2NC40OCw3MzcuMDk4IDIyNS45NjksNjc1LjYwOSBMIDM2My41MzUsNTM4LjAzNSBWIDczMi41OSBjIDAsODYuOTQ5IC02NS42OCwxNTguNTM1IC0xNTAuMTM3LDE2Ny45MTQiCiAgICAgICAgIHN0eWxlPSJmaWxsOiM1MGM0YmY7ZmlsbC1vcGFjaXR5OjE7ZmlsbC1ydWxlOm5vbnplcm87c3Ryb2tlOm5vbmUiCiAgICAgICAgIGlkPSJwYXRoNDIiIC8+CiAgICAgIDxwYXRoCiAgICAgICAgIGQ9Ik0gNTEzLjY3Niw5MDAuNTA0IEMgNDI5LjIyMyw4OTEuMTI1IDM2My41MzUsODE5LjUzOSAzNjMuNTM1LDczMi41OSBWIDUzOC4wMzUgbCAxMzcuNTcsMTM3LjU3NCBjIDYxLjQ4NSw2MS40ODkgNjUuNjU3LDE1OC41NDcgMTIuNTcxLDIyNC44OTUiCiAgICAgICAgIHN0eWxlPSJmaWxsOiMxZjQ5M2E7ZmlsbC1vcGFjaXR5OjE7ZmlsbC1ydWxlOm5vbnplcm87c3Ryb2tlOm5vbmUiCiAgICAgICAgIGlkPSJwYXRoNDQiIC8+CiAgICA8L2c+CiAgPC9nPgo8L3N2Zz4K" alt="Inecta Logo">
      <button id="newChatBtn" title="Start a new conversation">New Chat</button>
    </div>
    <div id="topicTracker" class="topic-tracker"></div>
    <div id="chat" class="chat"></div>
    <div class="input-area">
      <input id="messageInput" type="text" placeholder="Type your message..." autofocus/>
      
      <input type="file" id="fileUploader" style="display: none;" accept=".txt,.md,.pdf,.doc,.docx"/>
      <button id="uploadButton" title="Upload a document">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"></path></svg>
      </button>

      <button id="sendButton" title="Send message">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 2 11 13M22 2l-7 20-4-9-9-4 20-7z"/></svg>
      </button>

      <button id="reportButton">VIEW REPORT</button>
      <button id="scheduleButton">SCHEDULE A CALL</button>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // --- CONFIGURATION ---
      // IMPORTANT: Replace these with your actual n8n webhook URLs
      const config = {
        chatWebhookUrl: 'https://inecta.app.n8n.cloud/webhook/chat-handler',
        fileWebhookUrl: 'YOUR_DOCUMENT_PROCESSOR_WEBHOOK_URL',
        reportWebhookUrl: 'YOUR_REPORT_GENERATOR_WEBHOOK_URL',
        scheduleUrl: 'https://meetings.hubspot.com/daniel430/mini-rg-dan-and-sheila'
      };
      const INTRO_MESSAGE = "Hello! I'm an AI assistant from Inecta, here to help with your business requirements and gap analysis. To get started, could you please tell me your name and a bit about your company? You can also upload a document (like an RFP) at any time using the paperclip icon.";
      
      // --- DOM ELEMENTS ---
      const elements = {
        chat: document.getElementById('chat'),
        input: document.getElementById('messageInput'),
        sendButton: document.getElementById('sendButton'),
        reportButton: document.getElementById('reportButton'),
        scheduleButton: document.getElementById('scheduleButton'),
        topicTracker: document.getElementById('topicTracker'),
        uploadButton: document.getElementById('uploadButton'),
        fileUploader: document.getElementById('fileUploader'),
        newChatButton: document.getElementById('newChatBtn'),
      };
      
      // --- STATE MANAGEMENT ---
      let sessionId = null;

      // --- CORE FUNCTIONS ---

      function getSessionId() {
        if (sessionId) return sessionId;
        let storedId = localStorage.getItem('inecta_chat_session_id');
        if (!storedId) {
          storedId = crypto.randomUUID();
          localStorage.setItem('inecta_chat_session_id', storedId);
          console.log("New user. Started new session:", storedId);
          // Add the intro message for brand new sessions
          renderMessage('bot', INTRO_MESSAGE, false);
        } else {
          console.log("Returning user. Resuming session:", storedId);
        }
        sessionId = storedId;
        return sessionId;
      }

      function startNewChat() {
        const currentSessionId = getSessionId();
        console.log("Starting new chat. Clearing local storage for session:", currentSessionId);
        localStorage.removeItem(`chatHistory_${currentSessionId}`);
        localStorage.removeItem(`topics_${currentSessionId}`);
        localStorage.removeItem('inecta_chat_session_id');
        
        // Clear UI
        elements.chat.innerHTML = '';
        elements.topicTracker.innerHTML = '';
        sessionId = null; // Force re-initialization
        
        // Re-initialize
        initializeSession();
      }

      function renderMessage(role, content, save = true) {
        const msgDiv = document.createElement('div');
        msgDiv.className = `msg ${role}`;
        
        // Basic Markdown-like replacements
        content = content.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
        content = content.replace(/\[(.*?)\]\((.*?)\)/g, '<a href="$2" target="_blank">$1</a>');
        msgDiv.innerHTML = content.trim(); 
        
        elements.chat.appendChild(msgDiv);
        scrollToBottom();

        if (save) {
          const history = getChatHistory();
          history.push({ role, content });
          saveChatHistory(history);
        }
      }

      function updateTopicTracker(newTopics = []) {
        if (!newTopics || newTopics.length === 0) return;
        localStorage.setItem(`topics_${getSessionId()}`, JSON.stringify(newTopics));
        
        elements.topicTracker.innerHTML = '';
        newTopics.forEach(topic => {
          const topicDiv = document.createElement('div');
          topicDiv.className = 'topic-item';
          const statusClass = `status-${topic.status.toLowerCase().replace(/\s+/g, '-')}`;
          topicDiv.classList.add(statusClass);
          topicDiv.textContent = topic.status === 'Completed' ? `✓ ${topic.name}` : topic.name;
          elements.topicTracker.appendChild(topicDiv);
        });
      }
      
      function setUiLoadingState(isLoading) {
        if (isLoading) {
            elements.sendButton.disabled = true;
            elements.uploadButton.disabled = true;
            const indicator = document.createElement('div');
            indicator.id = 'typingIndicator';
            indicator.className = 'msg bot typing-indicator';
            indicator.innerHTML = '<span></span><span></span><span></span>';
            elements.chat.appendChild(indicator);
            scrollToBottom();
        } else {
            const indicator = document.getElementById('typingIndicator');
            if (indicator) indicator.remove();
            elements.sendButton.disabled = false;
            elements.uploadButton.disabled = false;
            elements.input.focus();
        }
      }

      function scrollToBottom() {
        elements.chat.scrollTop = elements.chat.scrollHeight;
      }

      // --- LOCAL STORAGE HELPERS ---
      function getChatHistory() {
        const saved = localStorage.getItem(`chatHistory_${getSessionId()}`);
        return saved ? JSON.parse(saved) : [];
      }

      function saveChatHistory(history) {
        localStorage.setItem(`chatHistory_${getSessionId()}`, JSON.stringify(history));
      }

      function loadSessionState() {
        const history = getChatHistory();
        const topics = JSON.parse(localStorage.getItem(`topics_${getSessionId()}`) || '[]');
        
        elements.chat.innerHTML = ''; // Clear chat
        history.forEach(msg => renderMessage(msg.role, msg.content, false));
        updateTopicTracker(topics);
      }

      // --- ASYNC HANDLERS ---
      async function handleSend() {
        const userContent = elements.input.value.trim();
        if (!userContent) return;

        renderMessage('user', userContent);
        elements.input.value = '';
        setUiLoadingState(true);

        try {
          const response = await fetch(config.chatWebhookUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              session_id: getSessionId(),
              message: userContent
            })
          });

          if (!response.ok) throw new Error(`HTTP Error: ${response.status}`);
          
          const responseData = await response.json();
          renderMessage('bot', responseData.reply);
          
          if (responseData.topics) {
            updateTopicTracker(responseData.topics);
          }

          if (responseData.isDiscoveryComplete === true) {
            showCompletionControls(true);
          }
          
        } catch (error) {
          console.error('Chat Fetch error:', error);
          renderMessage('bot', 'Sorry, there was an error connecting. Please try again.', false);
        } finally {
          setUiLoadingState(false);
        }
      }

      async function handleFileUpload(event) {
        const file = event.target.files[0];
        if (!file) return;

        setUiLoadingState(true);
        renderMessage('bot', `<em>Uploading "${file.name}" for analysis. This may take a moment...</em>`, false);
        
        const formData = new FormData();
        formData.append('session_id', getSessionId());
        formData.append('fileUploader', file, file.name);

        try {
          const response = await fetch(config.fileWebhookUrl, {
            method: 'POST',
            body: formData
          });
          
          if (!response.ok) throw new Error(`File Upload HTTP Error: ${response.status}`);

          const result = await response.json();
          renderMessage('bot', result.message, false); // e.g., "I've received the document..."
        
        } catch (error) {
          console.error('File Upload Error:', error);
          renderMessage('bot', '<em>There was an error uploading the file. Please try again.</em>', false);
        } finally {
          setUiLoadingState(false);
          elements.fileUploader.value = ''; // Clear the input for next upload
        }
      }

      async function handleViewReport() {
        elements.reportButton.textContent = 'GENERATING...';
        elements.reportButton.disabled = true;
        try {
          const response = await fetch(config.reportWebhookUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ session_id: getSessionId() })
          });
          if (!response.ok) throw new Error(`Report Error: ${response.statusText}`);
          
          const reportHtml = await response.text();
          const reportWindow = window.open();
          if (reportWindow) {
            reportWindow.document.write(reportHtml);
            reportWindow.document.close();
          } else {
            renderMessage('bot', '<em>Please allow pop-ups to view the report.</em>', false);
          }
        } catch (error) {
          console.error('Report Fetch error:', error);
          renderMessage('bot', '<em>Could not generate the report at this time.</em>', false);
        } finally {
          elements.reportButton.textContent = 'VIEW REPORT';
          elements.reportButton.disabled = false;
        }
      }

      function showCompletionControls(isComplete) {
        if (isComplete) {
            elements.reportButton.style.display = 'inline-block';
            elements.scheduleButton.style.display = 'inline-block';
            elements.sendButton.style.display = 'none';
            elements.uploadButton.style.display = 'none';
            elements.input.style.display = 'none';
        } else {
            elements.reportButton.style.display = 'none';
            elements.scheduleButton.style.display = 'none';
            elements.sendButton.style.display = 'inline-flex';
            elements.uploadButton.style.display = 'inline-flex';
            elements.input.style.display = 'block';
        }
      }

      // --- INITIALIZATION & EVENT LISTENERS ---
      function initializeSession() {
        getSessionId(); // This ensures a session ID exists
        loadSessionState();
        showCompletionControls(false); // Ensure normal controls are visible on load
      }

      elements.sendButton.addEventListener('click', handleSend);
      elements.input.addEventListener('keypress', (e) => { if (e.key === 'Enter' && !elements.sendButton.disabled) handleSend(); });
      elements.reportButton.addEventListener('click', handleViewReport);
      elements.scheduleButton.addEventListener('click', () => window.open(config.scheduleUrl, '_blank'));
      elements.uploadButton.addEventListener('click', () => elements.fileUploader.click());
      elements.fileUploader.addEventListener('change', handleFileUpload);
      elements.newChatButton.addEventListener('click', startNewChat);

      initializeSession();
    });
  </script>
</body>
</html>
